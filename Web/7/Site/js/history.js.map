{
  "version": 3,
  "file": "history.js",
  "sourceRoot": "..\\coffescript",
  "sources": [
    "history.coffee"
  ],
  "names": [],
  "mappings": ";AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAA,kBAAA,EAAA,UAAA,EAAA,kBAAA,EAAA,YAAA,EAAA,OAAA,EAAA,SAAA,EAAA,YAAA,EAAA,iBAAA,EAAA,WAAA,EAAA,SAAA,EAAA;;EAAA,WAAA,GAAc,YAAd;;;EAEA,OAAA,GAAU,MAFV;;;;;;;;;EAYA,SAAA,GAAY,QAAA,CAAC,UAAD,CAAA;AACZ,QAAA,CAAA,EAAA,EAAA,EAAA,aAAA,EAAA,CAAA,EAAA;IAAI,IAAA,GAAO,UAAA,GAAa;IACpB,aAAA,GAAgB,kBAAA,CAAmB,QAAQ,CAAC,MAA5B;IAChB,EAAA,GAAK,aAAa,CAAC,KAAd,CAAoB,GAApB;IACL,CAAA,GAAI;IACJ,CAAA,GAAI;AACJ,WAAM,CAAA,GAAI,EAAE,CAAC,MAAb;MACI,CAAA,GAAI,EAAE,CAAC,CAAD;AACN,aAAM,CAAC,CAAC,MAAF,CAAS,CAAT,CAAA,KAAe,GAArB;QACI,CAAA,GAAI,CAAC,CAAC,SAAF,CAAY,CAAZ;MADR;MAEA,IAAG,CAAC,CAAC,OAAF,CAAU,IAAV,CAAA,KAAmB,CAAtB;AACI,eAAO,CAAC,CAAC,SAAF,CAAY,IAAI,CAAC,MAAjB,EAAyB,CAAC,CAAC,MAA3B,EADX;;MAEA,CAAA;IANJ;WAOA;EAbQ;;EAsBZ,SAAA,GAAY,QAAA,CAAC,UAAD,EAAa,WAAb,CAAA;IACR,QAAQ,CAAC,MAAT,GAAkB,UAAA,GAAa,GAAb,GAAmB;EAD7B;;EAUZ,gBAAA,GAAmB,QAAA,CAAC,IAAD,CAAA;AACnB,QAAA,cAAA,EAAA;IAAI,cAAA,GAAiB,YAAY,CAAC,OAAb,CAAqB,IAArB;IACjB,IAAA,GAAO,CACH,QAAQ,CAAC,KADN,EAEH,QAAQ,CAAC,QAAQ,CAAC,QAFf;IAIP,IAAG,MAAM,CAAC,EAAP,CAAU,cAAV,EAA0B,IAA1B,CAAH;;MAEI,cAAA,GAAiB,CAAE,IAAF,EAFrB;KAAA,MAAA;MAII,cAAA,GAAiB,IAAI,CAAC,KAAL,CAAW,cAAX;MACjB,cAAc,CAAC,IAAf,CAAoB,IAApB,EALJ;;IAMA,YAAY,CAAC,OAAb,CAAqB,IAArB,EAA2B,IAAI,CAAC,SAAL,CAAe,cAAf,CAA3B;EAZe;;EAwBnB,kBAAA,GAAqB,QAAA,CAAC,cAAD,CAAA;AACrB,QAAA,IAAA,EAAA,GAAA,EAAA;IAAI,oBAAA,GAAuB;IACvB,IAAA,GAAO;IACP,GAAA,GAAM;IACN,cAAc,CAAC,OAAf,CAAuB,QAAA,CAAC,IAAD,CAAA;MACnB,oBAAoB,CAAC,OAArB,CAA6B,QAAA,CAAC,OAAD,CAAA;QACzB,IAAG,OAAO,CAAC,CAAD,CAAP,KAAc,IAAI,CAAC,CAAD,CAArB;UACI,IAAA,GAAO;UACP,OAAO,CAAC,CAAD,CAAP,GAFJ;;MADyB,CAA7B;MAKA,IAAG,IAAH;QACI,GAAA,GAAM;QACN,GAAG,CAAC,IAAJ,CAAS,IAAT;QACA,GAAG,CAAC,CAAD,CAAG,CAAC,IAAP,CAAY,CAAZ;QACA,oBAAoB,CAAC,IAArB,CAA0B,GAA1B,EAJJ;OAAA,MAAA;QAMI,IAAA,GAAO,KANX;;IANmB,CAAvB;WAcA;EAlBiB;;EA2BrB,iBAAA,GAAoB,QAAA,CAAC,OAAD,EAAU,YAAV,CAAA;AACpB,QAAA,QAAA,EAAA,IAAA,EAAA,EAAA,EAAA;IAAI,IAAA,GAAO,IAAI,IAAJ,CAAS,QAAA,CAAS,OAAT,CAAT;IACP,EAAA,GAAK,CAAA,CAAE,OAAF;IACL,QAAA,GAAW,IAAI,CAAC,KAAL,CAAW,YAAY,CAAC,OAAb,CAAqB,OAArB,CAAX;IACX,IAAG,OAAH;MACI,QAAQ,CAAC,OAAT,CAAiB,QAAA,CAAC,IAAD,CAAA;QACb,EAAE,CAAC,MAAH,CAAU,CAAA,CAAE,OAAF,CAAU,CAAC,MAAX,CAAkB,CAAA,CAAE,MAAF,CAAS,CAAC,IAAV,CAAe,IAAI,CAAC,CAAD,CAAnB,CAAuB,CAAC,IAAxB,CAA6B,MAA7B,EAAqC,IAAI,CAAC,CAAD,CAAzC,CAAlB,CAAV;MADa,CAAjB,EADJ;KAAA,MAAA;MAKI,WAAA,GAAc,kBAAA,CAAmB,QAAnB;MACd,WAAW,CAAC,OAAZ,CAAoB,QAAA,CAAC,IAAD,CAAA;QAChB,EAAE,CAAC,MAAH,CAAU,CAAA,CAAE,OAAF,CAAU,CAAC,MAAX,CAAkB,CAAA,CAAE,MAAF,CAAS,CAAC,IAAV,CAAe,IAAI,CAAC,CAAD,CAAJ,GAAU,GAAV,GAAgB,IAAI,CAAC,CAAD,CAApB,GAA0B,GAAzC,CAA6C,CAAC,IAA9C,CAAmD,MAAnD,EAA2D,IAAI,CAAC,CAAD,CAA/D,CAAlB,CAAV;MADgB,CAApB,EANJ;;IASA,YAAY,CAAC,MAAb,CAAoB,CAAA,CAAE,QAAF,CAAW,CAAC,MAAZ,CAAmB,CAAA,CAAE,MAAF,CAAS,CAAC,IAAV,CAAe,IAAI,CAAC,QAAL,CAAA,CAAf,CAAnB,CAAmD,CAAC,MAApD,CAA2D,EAA3D,CAApB,CAAmF,CAAC,MAApF,CAA2F,CAAA,CAAE,OAAF,CAA3F;EAbgB;;EAuBpB,YAAA,GAAe,QAAA,CAAC,cAAD,CAAA;AACf,QAAA,IAAA,EAAA,eAAA,EAAA,YAAA,EAAA;IAAI,YAAA,GAAe,CAAA,CAAE,UAAF;IACf,mBAAA,GAAsB,CAAA,CAAE,kBAAF;IACtB,eAAA,GAAkB,CAAA,CAAE,cAAF;IAClB,IAAG,YAAY,CAAC,MAAhB;MACI,IAAA,GAAO,IAAI,IAAJ,CAAA,EAAf;;MAEQ,mBAAmB,CAAC,MAApB,CAA2B,CAAA,CAAE,MAAF,CAAS,CAAC,IAAV,CAAe,gBAAf,CAAgC,CAAC,GAAjC,CACvB;QAAA,WAAA,EAAa,OAAb;QACA,gBAAA,EAAkB;MADlB,CADuB,CAA3B;MAGA,iBAAA,CAAkB,cAAlB,EAAkC,mBAAlC,EALR;;MAOQ,eAAe,CAAC,MAAhB,CAAuB,CAAA,CAAE,MAAF,CAAS,CAAC,IAAV,CAAe,eAAf,CAA+B,CAAC,GAAhC,CACnB;QAAA,WAAA,EAAa,OAAb;QACA,gBAAA,EAAkB;MADlB,CADmB,CAAvB;MAGA,MAAM,CAAC,IAAP,CAAY,YAAZ,CAAyB,CAAC,OAA1B,CAAkC,QAAA,CAAC,OAAD,CAAA;QAC9B,iBAAA,CAAkB,OAAlB,EAA2B,eAA3B;MAD8B,CAAlC,EAXJ;;EAJW;;EAwBf,YAAA,GAAe,QAAA,CAAA,CAAA;IACX,MAAM,CAAC,IAAP,CAAY,YAAZ,CAAyB,CAAC,OAA1B,CAAkC,QAAA,CAAC,OAAD,CAAA;MAC9B,YAAY,CAAC,UAAb,CAAwB,OAAxB;IAD8B,CAAlC;EADW;;EAUf,kBAAA,GAAqB,QAAA,CAAA,CAAA;IACjB,CAAA,CAAE,kBAAF,CAAqB,CAAC,KAAtB,CAAA;IACA,CAAA,CAAE,cAAF,CAAiB,CAAC,KAAlB,CAAA;EAFiB;;EASrB,UAAA,GAAa,QAAA,CAAC,cAAD,CAAA;IACT,OAAA,GAAU,CAAC;IACX,kBAAA,CAAA;IACA,YAAA,CAAa,cAAb;EAHS;;EAMb,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,QAAA,CAAA,CAAA;AAChC,QAAA,gBAAA,EAAA;IAAI,SAAA,GAAY,SAAA,CAAU,WAAV;IACZ,gBAAA,GAAmB,CAAA,CAAE,qBAAF;IACnB,IAAG,gBAAgB,CAAC,MAApB;MACI,gBAAgB,CAAC,IAAjB,CAAsB,OAAtB,EAA+B,QAAA,CAAA,CAAA,EAAA;;QAE3B,UAAA,CAAW,SAAX;MAF2B,CAA/B,EADJ;;IAKA,IAAG,SAAA,KAAa,EAAhB;;MAEI,SAAA,GAAY,CAAC,IAAI,IAAJ,CAAA,CAAD,CAAU,CAAC,OAAX,CAAA;MACZ,SAAA,CAAU,WAAV,EAAuB,SAAvB,EAHJ;;IAIA,gBAAA,CAAiB,SAAjB,EAXJ;;IAaI,YAAA,CAAa,SAAb;EAd4B,CAAhC;;EAvKA;AAAA",
  "sourcesContent": [
    "sessionName = 'mySession'\r\n# Наименование значения куки\r\ndisplay = false\r\n# Режим отображения. False - сжатый; True - подробный.\r\n\r\n###\r\n* Возвращает значение запрашиваемой куки\r\n*\r\n* @param {string} cookieName Наименование куки\r\n* @return {string} Значение куки, если такая есть, иначе - пустая строка\r\n###\r\n\r\ngetCookie = (cookieName) ->\r\n    name = cookieName + '='\r\n    decodedCookie = decodeURIComponent(document.cookie)\r\n    ca = decodedCookie.split(';')\r\n    c = ''\r\n    i = 0\r\n    while i < ca.length\r\n        c = ca[i]\r\n        while c.charAt(0) == ' '\r\n            c = c.substring(1)\r\n        if c.indexOf(name) == 0\r\n            return c.substring(name.length, c.length)\r\n        i++\r\n    ''\r\n\r\n###\r\n* Устанавливает куки\r\n*\r\n* @param {string} cookieName Наименование устанавливаемой куки\r\n* @param {string} cookieValue Значение устанавливаемой куки\r\n###\r\n\r\nsetCookie = (cookieName, cookieValue) ->\r\n    document.cookie = cookieName + '=' + cookieValue\r\n    return\r\n\r\n###\r\n* Сохраняет текущую страницу в истории посещений\r\n*\r\n* @param {string} name Наименование элемента в localStorage\r\n###\r\n\r\nstoreCurrentPage = (name) ->\r\n    currentHistory = localStorage.getItem(name)\r\n    page = [\r\n        document.title\r\n        document.location.pathname\r\n    ]\r\n    if Object.is(currentHistory, null)\r\n# Если такого эл-та в localstorage нет\r\n        currentHistory = [ page ]\r\n    else\r\n        currentHistory = JSON.parse(currentHistory)\r\n        currentHistory.push page\r\n    localStorage.setItem name, JSON.stringify(currentHistory)\r\n    return\r\n\r\n###\r\n* Удаляет все дубликаты и подсчитывает их количество\r\n*\r\n* @param {Object} sessionHistory Массив, хранящийся в localStorage с пользовательской историей перемещений по сайту\r\n*\r\n* @return {Object} uniqueSessionHistory Тот же sessionHistory, но без дубликатов и с дополнительным полем для\r\n*   каждого элемента - количеством найденных дубликатов\r\n###\r\n\r\nbuildUniqueHistory = (sessionHistory) ->\r\n    uniqueSessionHistory = []\r\n    flag = true\r\n    her = []\r\n    sessionHistory.forEach (page) ->\r\n        uniqueSessionHistory.forEach (element) ->\r\n            if element[0] == page[0]\r\n                flag = false\r\n                element[2]++\r\n            return\r\n        if flag\r\n            her = []\r\n            her.push page\r\n            her[0].push 1\r\n            uniqueSessionHistory.push her\r\n        else\r\n            flag = true\r\n        return\r\n    uniqueSessionHistory\r\n\r\n###\r\n* Добавляет к блоку информацию о истории просмотров\r\n*\r\n* @param {string} session Идентефикатор сессии, который необходимо вывести\r\n* @param {Object} historyBlock Элемент DOM, в который необходимо выводить информацию\r\n###\r\n\r\nprintHistoryBlock = (session, historyBlock) ->\r\n    date = new Date(parseInt(session))\r\n    ul = $('<ul/>')\r\n    allItems = JSON.parse(localStorage.getItem(session))\r\n    if display\r\n        allItems.forEach (page) ->\r\n            ul.append $('<li/>').append($('<a/>').text(page[0]).attr('href', page[1]))\r\n            return\r\n    else\r\n        uniqueItems = buildUniqueHistory(allItems)\r\n        uniqueItems.forEach (page) ->\r\n            ul.append $('<li/>').append($('<a/>').text(page[0] + '(' + page[2] + ')').attr('href', page[1]))\r\n            return\r\n    historyBlock.append($('<div/>').append($('<p/>').text(date.toString())).append(ul)).append $('<br/>')\r\n    return\r\n\r\n###\r\n* Выводит историю в элемент history_block, если такой существует\r\n*\r\n* Тут уже говнокодил, пуш надоело писать нормально))0э\r\n* Но суть функции, думаю, понятна\r\n###\r\n\r\nprintHistory = (currentSession) ->\r\n    historyBlock = $('#history')\r\n    historyCurrentBlock = $('#history_current')\r\n    historyAllBlock = $('#history_all')\r\n    if historyBlock.length\r\n        date = new Date\r\n        # Выведем текущий сеанс\r\n        historyCurrentBlock.append $('<p/>').text('Текущий сеанс:').css(\r\n            'font-size': '1.2em'\r\n            'padding-bottom': '10px')\r\n        printHistoryBlock currentSession, historyCurrentBlock\r\n        # Выведем всю историю посещений\r\n        historyAllBlock.append $('<p/>').text('За всё время:').css(\r\n            'font-size': '1.2em'\r\n            'padding-bottom': '10px')\r\n        Object.keys(localStorage).forEach (session) ->\r\n            printHistoryBlock session, historyAllBlock\r\n            return\r\n    return\r\n\r\n###\r\n* Очищает всю историю посещений\r\n###\r\n\r\nclearStorage = ->\r\n    Object.keys(localStorage).forEach (session) ->\r\n        localStorage.removeItem session\r\n        return\r\n    return\r\n\r\n###\r\n* Очищает блоки с историей посещений\r\n###\r\n\r\nclearHistoryBlocks = ->\r\n    $('#history_current').empty()\r\n    $('#history_all').empty()\r\n    return\r\n\r\n###\r\n* Изменяет режим отображения истории на более или на менее подробную\r\n###\r\n\r\nchangeMode = (currentSession) ->\r\n    display = !display\r\n    clearHistoryBlocks()\r\n    printHistory currentSession\r\n    return\r\n\r\nwindow.addEventListener 'load', ->\r\n    cookieVal = getCookie(sessionName)\r\n    changeModeButton = $('#change_mode_button')\r\n    if changeModeButton.length\r\n        changeModeButton.bind 'click', ->\r\n# Переключение режима отображения по кнопке\r\n            changeMode cookieVal\r\n            return\r\n    if cookieVal == ''\r\n# Если такого куки нет, создать новый\r\n        cookieVal = (new Date).getTime()\r\n        setCookie sessionName, cookieVal\r\n    storeCurrentPage cookieVal\r\n    # Сохранить текущую ссылку в истории\r\n    printHistory cookieVal\r\n    # Вывести (попытаться) историю в блок history_block\r\n    return"
  ]
}